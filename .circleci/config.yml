version: 2
jobs:
  build:
    working_directory: ~/TeachstoneLLC/myteachstone
    parallelism: 5
    shell: /bin/bash --login
    environment:
    - CIRCLE_ARTIFACTS: /tmp/circleci-artifacts
    - CIRCLE_TEST_REPORTS: /tmp/circleci-test-results
    - API_SYNC_TOKEN: testing
    - MY_CLASS_BASE_URL: https://int.teachstone.com
    - LOCALEAPP_API: testing
    docker:
    - image: circleci/build-image:ubuntu-14.04-XXL-upstart-1189-5614f37
      command: /sbin/init
      environment:
        TZ: "/usr/share/zoneinfo/Asia/Tokyo"
        LANG: "en_US.utf8"
        LC_ALL: "en_US.utf8"
        LC_CTYPE: "en_US.utf8"
    - image: redis
    steps:
    - checkout
    - run: mkdir -p $CIRCLE_ARTIFACTS $CIRCLE_TEST_REPORTS
    - run:
        name: Set timezone to Asia/Tokyo
        working_directory: ~/workcloud/workcloud
        command: |
            set +e
            echo 'Asia/Tokyo' | sudo tee -a /etc/timezone
            sudo cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
            sudo dpkg-reconfigure -f noninteractive tzdata
    - run: sudo apt-get update;
# workflows:
#   version: 2
#   workflow:
#     jobs:
#     - build
